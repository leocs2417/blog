---
layout: post
title: "如何优化Web移动端的加载速度?"
date: 2019-11-07 23:00
comments: true
categories:
		- JS
tags:
		- JS
---

> 电脑端有着更好的处理器, 并且与网络的连接, 通常比移动端设备的网络速度更快速和稳定. 通常情况下, 在网站中即使做了针对移动设备的优化, 加载速度可能也会比在电脑端慢.

<!-- more -->

页面速度(或网站加载速度)是移动搜索引擎优化(SEO)的主要方面. Web性能不仅影响搜索排名, 影响用户的移动体验. 

## 如何优化移动端页面加载速度:

### 加载相关:

#### 首屏渲染优化: 

- 尽量避免**非首屏资源**的加载: 
  
  首屏渲染速度会直接影响终端用户对网站加载速度的印象, 首先要减少首屏渲染加载的资源, 进而加快首屏渲染速度.

- 采用**组件化开发**, 按需加载:

  使用Vue/React等成熟第三方JS框架开发时, 可以配合webpack等使用组件/组件库的按需加载, 进而减少首屏加载的资源.

#### 预加载和懒加载:

- 预加载其他页面或资源:

  在首屏渲染结束后, 可以先预先加载其他主要页面, 进而加快交互后的加载速度.

- 图片或列表的懒加载:

  当用户主动点击/滚动交互到特定位置时, 采用**LazyLoad**的形式加载图片或列表等.


- 采用CDN加速

  一些静态资源可以利用CDN的方式引入, 使其缓存在浏览器中, 进而减少开销.

### 资源压缩与合并:

#### 资源的压缩:

- 图片的压缩: 利用第三方工具减小图片的体积.

#### 资源合并

- 使用`CSS`雪碧图: 把需要的一些图片整合成一张

  优点: 减少**HTTP请求次数**(backgroundPosition).
  
  缺点: 图片比较大时, 加载慢, 且存在加载失败都不能显示的风险. 
  
- 利用webpack等工具, 合理地**合并代码**, 进而减少**HTTP请求次数**.

### 合理利用缓存:

- localStorage

  一些非必要实时更新的参数, 可以利用缓存放在本地, 进而减少请求.

### 渲染优化:

- 16ms优化:

  目前大多数设备的屏幕刷新率仍为60hz, 每帧所消耗的时间约为16ms, 这16ms就是渲染帧的时长.
  
  浏览器还有一些整理工作要做, 因此一次EventLoop内的视图渲染要在10ms内完成.

  如果超出这个时间, 将会出现掉帧的表现.

- 减少重绘和重排(回流)

  页面的重绘和重排(回流)很耗性能, 所以一定要尽可能减少页面的重绘和重排(回流), 例如页面图片大小变化、元素位置变化等这些情况都会导致重绘和重排(回流).

### 防抖与节流:

- 常见场景: 

  窗口**resize**, **scroll**,以及input框中搜索请求数据等.

- 合理使用防抖/节流:

  减少**函数调用次数**、**网络请求次数**.

### 为什么要减少HTTP请求?

- HTTP请求建立和释放需要时间:
  客户端连接到Web服务器->发送HTTP请求->服务器接受请求并返回HTTP响应->释放连接TCP链接

  如果http请求很多, 不合并http请求就会耗费大量时间再建立和释放上.

- 浏览器对同个域名下的并发请求数量是有限制的: 

  若并发请求过多, 后续的请求只能等前面的结束完后才开始.

  所以要尽量减少页面的请求数, 首次加载同时请求数不能超过4个.